<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> é¡ºå¿ƒè›‡è¡Œï½œè´¢è¿è¿è¿ </title>
    <style>
        /* é¡µé¢æ•´ä½“æ ·å¼ */
        body {
            display: flex; /* ä½¿ç”¨ Flexbox å¸ƒå±€ */
            flex-direction: column; /* å‚ç›´æ’åˆ—å…ƒç´  */
            align-items: center; /* æ°´å¹³å±…ä¸­ */
            justify-content: flex-start; /* å‚ç›´ä»é¡¶éƒ¨å¼€å§‹ */
            height: 100vh; /* é«˜åº¦ä¸ºè§†å£é«˜åº¦ */
            margin: 0; /* å»é™¤é»˜è®¤å¤–è¾¹è· */
            background-color: #920f0c; /* èƒŒæ™¯é¢œè‰² */
            color: #d3a35a; /* æ–‡æœ¬é¢œè‰² */
            font-family: Arial, sans-serif; /* å­—ä½“ */
        }
        #main-title {
            font-size: 1.4em; /* æ ‡é¢˜å­—ä½“å¤§å° */
            margin: 30px 0; /* ä¸Šä¸‹å¤–è¾¹è· */
	    color: #e3ca88; /* æ–‡æœ¬é¢œè‰² */
        }
        #main-title1 {
            font-size: 0.4em; /* ä¸‹é¢å°å­—å­—ä½“å¤§å° */
            margin: 1.5px 0; /* ä¸Šä¸‹å¤–è¾¹è· */
	    color: #e3ca88; /* æ–‡æœ¬é¢œè‰² */
        }
        #gameWrapper {
            width: 85vmin; /* å®½åº¦ä¸ºè§†å£æœ€å°å®½é«˜çš„ 80% */
            height: 110vmin; /* é«˜åº¦ä¸ºè§†å£æœ€å°å®½é«˜çš„ 110% */
            border: 5px solid #c8a56f; /* è¾¹æ¡†æ ·å¼ */
            background-color: #20232a; /* èƒŒæ™¯é¢œè‰² */
            display: flex; /* ä½¿ç”¨ Flexbox å¸ƒå±€ */
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
        }
        #gameContainer {
            display: flex; /* ä½¿ç”¨ Flexbox å¸ƒå±€ */
            justify-content: flex-end; /* æ°´å¹³é å³ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            width: 95%; /* å®½åº¦ä¸ºçˆ¶å…ƒç´ çš„ 95% */
            padding: 20px; /* å†…è¾¹è· */
        }
        #controls {
            display: flex; /* ä½¿ç”¨ Flexbox å¸ƒå±€ */
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            align-items: flex-end; /* æ°´å¹³é å³ */
            margin-right: 20px; /* å³å¤–è¾¹è· */
        }
        #buttons {
            display: flex; /* ä½¿ç”¨ Flexbox å¸ƒå±€ */
            gap: 10px; /* æŒ‰é’®ä¹‹é—´çš„é—´è· */
        }
        button {
            margin: 1px 1px; /* ä¸Šä¸‹å¤–è¾¹è· */
            padding: 3px 3px; /* å†…è¾¹è· */
            font-size: 0.7em; /* å­—ä½“å¤§å° */
            cursor: pointer; /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæ‰‹å‹ */
            background-color: #d3a35a; /* èƒŒæ™¯é¢œè‰² */
            border: none; /* æ— è¾¹æ¡† */
            border-radius: 12px; /* åœ†è§’ */
            color: #370600; /* æ–‡æœ¬é¢œè‰² */
        }
        #joystick {
            width: 22vmin; /* å®½åº¦ä¸ºè§†å£æœ€å°å®½é«˜çš„ 10% */
            height: 22vmin; /* é«˜åº¦ä¸ºè§†å£æœ€å°å®½é«˜çš„ 10% */
            background: #c8a56f; /* èƒŒæ™¯é¢œè‰² */
            border-radius: 50%; /* åœ†å½¢ */
            position: relative; /* ç›¸å¯¹å®šä½relative */
            touch-action: none; /* ç¦ç”¨è§¦æ‘¸é»˜è®¤è¡Œä¸º */
            margin-left: 24px; /* å·¦å¤–è¾¹è· */
            align-items: flex-end; /* æ°´å¹³é å³ */
            margin-right: 20px; /* å³å¤–è¾¹è· */
        }
        #stick {
            width: 8vmin; /* å®½åº¦ä¸ºè§†å£æœ€å°å®½é«˜çš„ 8% */
            height: 8vmin; /* é«˜åº¦ä¸ºè§†å£æœ€å°å®½é«˜çš„ 8% */
            background: darkred; /* èƒŒæ™¯é¢œè‰² */
            border-radius: 50%; /* åœ†å½¢ */
            position: absolute; /* ç»å¯¹å®šä½absolute */
            left: 7vmin; /* å·¦åç§» */
            top: 7vmin; /* ä¸Šåç§» */
            transition: left 0.1s, top 0.1s; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
        }
        .direction-icon {
            position: absolute; /* ç»å¯¹å®šä½ */
            font-size: 28px; /* å­—ä½“å¤§å° */
            color: darkred; /* é¢œè‰² */
            font-weight: bold; /* å­—ä½“åŠ ç²— */
        }
        .up { top: 5px; left: 50%; transform: translateX(-50%) rotate(270deg); }
        .down { bottom: 5px; left: 50%; transform: translateX(-50%) rotate(90deg); }
        .left { left: 5px; top: 50%; transform: translateY(-50%) rotate(180deg); }
        .right { right: 5px; top: 50%; transform: translateY(-50%); }

        /* è‡ªå®šä¹‰å¼¹çª—æ ·å¼ */
        #winModal {
	    width: 70vmin; /* å®½åº¦ä¸ºè§†å£æœ€å°å®½é«˜çš„ 80% */
            display: none; /* é»˜è®¤éšè— */
            position: fixed; /* å›ºå®šå®šä½ */
            top: 50%; /* å‚ç›´å±…ä¸­ */
            left: 50%; /* æ°´å¹³å±…ä¸­ */
            transform: translate(-50%, -50%); /* ç²¾ç¡®å±…ä¸­ */
            background: red; /* èƒŒæ™¯è‰² */
            color: white; /* å­—ä½“é¢œè‰² */
            padding: 20px; /* å†…è¾¹è· */
            border: 3px solid #c8a56f; /* è¾¹æ¡†æ ·å¼ */
            border-radius: 10px; /* åœ†è§’ */
            box-shadow: 0 0 10px rgba(0,0,0,0.5); /* é˜´å½± */
            text-align: center; /* æ–‡æœ¬å±…ä¸­ */
            z-index: 1000; /* å±‚çº§ */
            font-size: 12px; /* å­—ä½“å¤§å° */
        }
        #winModal button {
            margin-top: 10px; /* ä¸Šå¤–è¾¹è· */
            padding: 5px; /* å†…è¾¹è· */
            border: none; /* æ— è¾¹æ¡† */
            background-color: #c8a56f; /* èƒŒæ™¯è‰² */
            color: red; /* å­—ä½“é¢œè‰² */
            border-radius: 5px; /* åœ†è§’ */
            cursor: pointer; /* é¼ æ ‡æ ·å¼ */
        }
    </style>
</head>
<body>
    <h1 id="main-title">ğŸŒŸğŸï½œé¡ºå¿ƒè›‡è¡Œï½œè´¢è¿è¿è¿ï½œğŸğŸŒŸ</h1>

    <div id="gameWrapper">
        <canvas id="gameCanvas" width="400" height="550" style="width: 90%; height: 95%;"></canvas>
    </div>
    <div id="gameContainer">
        <div id="controls">
            <div id="buttons">
                <button onclick="restartGame()">é‡ç©</button>
                <button onclick="togglePause()">æš‚åœ/ç»§ç»­</button>
                <button onclick="increaseSpeed()">åŠ é€Ÿ</button>
                <button onclick="decreaseSpeed()">å‡é€Ÿ</button>
            </div>
            <div>
                <span id="speedDisplay">é€Ÿåº¦: 180</span>
                <span id="foodCount">ç¤¼ç‰©æ•°é‡: 0</span>
            </div>
        </div>
        <div id="joystick" onmousedown="startDrag(event)" ontouchstart="startDrag(event)">
            <div id="stick"></div>
            <span class="direction-icon up">â </span>
            <span class="direction-icon down">â </span>
            <span class="direction-icon left">â </span>
            <span class="direction-icon right">â </span>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰å¼¹çª— -->
    <div id="winModal">
        <h2>ğŸæ­å–œé€šå…³ï½œè´¢ç¥é€æ‚¨66è±ªç¤¼ğŸ</h2> <!-- å¼¹çª—å†…å®¹ -->
        <h2>ğŸŒŸè¾›å…‰æ„¿æ‚¨è›‡å¹´é¡ºå¿ƒå¦‚æ„ğŸŒŸ</h2> <!-- å¼¹çª—å†…å®¹ -->
        <button onclick="closeModal()">å…³é—­</button> <!-- å…³é—­æŒ‰é’® -->
    </div>
    <script>
        const canvas = document.getElementById("gameCanvas"); // è·å–ç”»å¸ƒå…ƒç´ 
        const ctx = canvas.getContext("2d"); // è·å– 2D ç»˜å›¾ä¸Šä¸‹æ–‡

        const box = canvas.width / 20; // æ¯ä¸ªæ–¹å—çš„å¤§å°
        let snake = [{x: 9 * box, y: 10 * box}]; // åˆå§‹åŒ–è›‡çš„ä½ç½®
        let direction = "RIGHT"; // åˆå§‹æ–¹å‘
        let foods = generateFoods(); // ç”Ÿæˆé£Ÿç‰©
        let score = 0; // åˆå§‹å¾—åˆ†
        let game; // æ¸¸æˆå¾ªç¯å˜é‡
        let speed = 180; // åˆå§‹é€Ÿåº¦
        let isPaused = false; // æ¸¸æˆæ˜¯å¦æš‚åœ

        function generateFoods() {
            const emojis = ["ğŸ§§", "ğŸ’°", "ğŸº",  "ğŸŒŸ", "ğŸ–", "ğŸ§§", "ğŸ†", "ğŸ", "ğŸ‰", "ğŸ’", "ğŸ’–", "ğŸ˜", "ğŸ˜˜", "ğŸ§§", "ğŸ§§", "ğŸ•", "ç¦"];
            const numFoods = Math.floor(Math.random() * 15) + 2; // éšæœºç”Ÿæˆé£Ÿç‰©æ•°é‡
            let foodsArray = [];
            for (let i = 0; i < numFoods; i++) {
                let foodPosition;
                do {
                    foodPosition = {
                        x: Math.floor(Math.random() * 18 + 0.5) * box,
                        y: Math.floor(Math.random() * 27 + 0.5) * box,
                    };
                } while (snake.some(part => part.x === foodPosition.x && part.y === foodPosition.y));
                foodsArray.push({
                    ...foodPosition,
                    emoji: emojis[Math.floor(Math.random() * emojis.length)]
                });
            }
            return foodsArray;
        }

        function updateFoodCount(count) {
            document.getElementById('foodCount').innerText = `| è´¢è¿æ•°é‡: ${count}`;
            if (count >= 66) {
                clearInterval(game); // åœæ­¢æ¸¸æˆ
                showWinModal(); // æ˜¾ç¤ºèƒœåˆ©å¼¹çª—
            }
        }

        function showWinModal() {
            const winModal = document.getElementById('winModal');
            winModal.style.display = 'block';
        }

        function closeModal() {
            const winModal = document.getElementById('winModal');
            winModal.style.display = 'none';
            restartGame();
        }

        function drawSnakePart(snakePart, isHead) {
            if (isHead) {
                ctx.fillStyle = "#61dafb"; // å¤´éƒ¨é¢œè‰²
                ctx.beginPath();
                const sizeMultiplier = 1.4; // å¤´éƒ¨å¤§å°å€æ•°
                const ellipseWidth = box * sizeMultiplier;
                const ellipseHeight = box;

                if (direction == "RIGHT" || direction == "LEFT") {
                    ctx.ellipse(
                        snakePart.x + box / 2,
                        snakePart.y + box / 2,
                        ellipseWidth / 2,
                        ellipseHeight / 2,
                        0,
                        0,
                        Math.PI * 2
                    );
                } else {
                    ctx.ellipse(
                        snakePart.x + box / 2,
                        snakePart.y + box / 2,
                        ellipseHeight / 2,
                        ellipseWidth / 2,
                        0,
                        0,
                        Math.PI * 2
                    );
                }

                ctx.fill();
                drawEyes(snakePart);
            } else {
                ctx.fillStyle = "#4caf50"; // è›‡èº«é¢œè‰²
                ctx.strokeStyle = "#20232a"; // è›‡èº«è¾¹æ¡†é¢œè‰²
                ctx.lineWidth = 2; // è¾¹æ¡†å®½åº¦
                ctx.beginPath();
                ctx.roundRect(snakePart.x, snakePart.y, box, box, 7.5); // ç»˜åˆ¶åœ†è§’çŸ©å½¢
                ctx.fill();
                ctx.stroke();
            }
        }

        function drawEyes(head) {
            ctx.fillStyle = "#fff"; // çœ¼ç›é¢œè‰²
            const eyeSize = box * 0.34; // çœ¼ç›å¤§å°
            const pupilSize = box * 0.18; // ç³å­”å¤§å°
            const eyeOffset = box * 0.38; // çœ¼ç›åç§»
            let eye1, eye2, pupil1, pupil2;

            switch (direction) {
                case "LEFT":
                    eye1 = {x: head.x + box / 2 - eyeOffset * 1.1, y: head.y + box / 2 - eyeOffset};
                    eye2 = {x: head.x + box / 2 - eyeOffset * 1.1, y: head.y + box / 2 + eyeOffset};
                    pupil1 = {x: eye1.x - 1, y: eye1.y};
                    pupil2 = {x: eye2.x - 1, y: eye2.y};
                    break;
                case "UP":
                    eye1 = {x: head.x + box / 2 - eyeOffset, y: head.y + box / 2 - eyeOffset * 1.1};
                    eye2 = {x: head.x + box / 2 + eyeOffset, y: head.y + box / 2 - eyeOffset * 1.1};
                    pupil1 = {x: eye1.x, y: eye1.y - 1};
                    pupil2 = {x: eye2.x, y: eye2.y - 1};
                    break;
                case "RIGHT":
                    eye1 = {x: head.x + box / 2 + eyeOffset * 1.1, y: head.y + box / 2 - eyeOffset};
                    eye2 = {x: head.x + box / 2 + eyeOffset * 1.1, y: head.y + box / 2 + eyeOffset};
                    pupil1 = {x: eye1.x + 1, y: eye1.y};
                    pupil2 = {x: eye2.x + 1, y: eye2.y};
                    break;
                case "DOWN":
                    eye1 = {x: head.x + box / 2 - eyeOffset, y: head.y + box / 2 + eyeOffset * 1.1};
                    eye2 = {x: head.x + box / 2 + eyeOffset, y: head.y + box / 2 + eyeOffset * 1.1};
                    pupil1 = {x: eye1.x, y: eye1.y + 1};
                    pupil2 = {x: eye2.x, y: eye2.y + 1};
                    break;
            }

            ctx.beginPath();
            ctx.arc(eye1.x, eye1.y, eyeSize, 0, Math.PI * 2); // ç»˜åˆ¶çœ¼ç›
            ctx.arc(eye2.x, eye2.y, eyeSize, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = "#000"; // ç³å­”é¢œè‰²
            ctx.beginPath();
            ctx.arc(pupil1.x, pupil1.y, pupilSize, 0, Math.PI * 2); // ç»˜åˆ¶ç³å­”
            ctx.arc(pupil2.x, pupil2.y, pupilSize, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawGame() {
            if (isPaused) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < snake.length; i++) {
                drawSnakePart(snake[i], i === 0);
            }

            ctx.font = `${box}px Arial`;
            foods.forEach(food => {
                ctx.fillText(food.emoji, food.x + 8, food.y + box - 8); // ç»˜åˆ¶é£Ÿç‰©
            });

            let snakeX = snake[0].x;
            let snakeY = snake[0].y;

            if (direction == "LEFT") snakeX -= box;
            if (direction == "UP") snakeY -= box;
            if (direction == "RIGHT") snakeX += box;
            if (direction == "DOWN") snakeY += box;

            if (snakeX < 0) snakeX = canvas.width - box;
            if (snakeY < 0) snakeY = canvas.height - box;
            if (snakeX >= canvas.width) snakeX = 0;
            if (snakeY >= canvas.height) snakeY = 0;

            let newHead = {x: snakeX, y: snakeY};

            let ateFood = false;
            foods.forEach((food, index) => {
                const distance = Math.sqrt(Math.pow(snakeX + box / 2 - (food.x + box / 2), 2) + Math.pow(snakeY + box / 2 - (food.y + box / 2), 2));
                if (distance < box * 1.5) {
                    score++;
                    foods.splice(index, 1);
                    ateFood = true;
                }
            });

            if (foods.length < 24) { // ä¿æŒé£Ÿç‰©æ•°é‡
                foods = foods.concat(generateFoods().slice(0, Math.min(24 - foods.length, Math.floor(Math.random() * 4))));
            }
           if (ateFood) { // ä¿æŒé£Ÿç‰©éšæœºå¢åŠ æ•°é‡
              const newFoods = generateFoods().slice(0, Math.floor(Math.random() * 4));
              foods = foods.concat(newFoods);
            }

            if (!ateFood) {
                snake.pop();
            }

            snake.unshift(newHead);

            updateFoodCount(score);
        }

        function increaseSpeed() {
            if (speed > 60) speed -= 20; // å¢åŠ é€Ÿåº¦
            resetGameInterval();
        }

        function decreaseSpeed() {
            if (speed < 240) speed += 20; // å‡å°‘é€Ÿåº¦
            resetGameInterval();
        }

        function resetGameInterval() {
            clearInterval(game);
            game = setInterval(drawGame, speed);
            updateSpeedDisplay();
        }

        function updateSpeedDisplay() {
            document.getElementById('speedDisplay').innerText = `é€Ÿåº¦: ${speed} `;
        }

        function restartGame() {
            snake = [{x: 9 * box, y: 10 * box}];
            direction = "RIGHT";
            foods = generateFoods();
            score = 0;
            updateFoodCount(score);
            resetGameInterval();
        }

        function togglePause() {
            isPaused = !isPaused;
        }

        window.onload = function() {
            game = setInterval(drawGame, speed);
        };

        document.addEventListener("keydown", function(event) {
            const key = event.keyCode;
            if (key === 37 && direction !== "RIGHT") direction = "LEFT";
            else if (key === 38 && direction !== "DOWN") direction = "UP";
            else if (key === 39 && direction !== "LEFT") direction = "RIGHT";
            else if (key === 40 && direction !== "UP") direction = "DOWN";
        });

        function startDrag(event) {
            event.preventDefault();
            document.addEventListener("mousemove", onDrag);
            document.addEventListener("mouseup", stopDrag);
            document.addEventListener("touchmove", onDrag);
            document.addEventListener("touchend", stopDrag);
        }

        function onDrag(event) {
            const joystick = document.getElementById("joystick");
            const rect = joystick.getBoundingClientRect();
            const x = (event.touches ? event.touches[0].clientX : event.clientX) - rect.left - rect.width / 2;
            const y = (event.touches ? event.touches[0].clientY : event.clientY) - rect.top - rect.height / 2;

            const angle = Math.atan2(y, x);
            const distance = Math.sqrt(x * x + y * y);
            const maxDistance = rect.width / 2;

            if (distance < maxDistance) {
                const stick = document.getElementById("stick");
                stick.style.left = `${x + rect.width / 2 - stick.offsetWidth / 2}px`;
                stick.style.top = `${y + rect.height / 2 - stick.offsetHeight / 2}px`;

                if (Math.abs(x) > Math.abs(y)) {
                    direction = x > 0 ? "RIGHT" : "LEFT";
                } else {
                    direction = y > 0 ? "DOWN" : "UP";
                }
            }
        }

        function stopDrag() {
            document.removeEventListener("mousemove", onDrag);
            document.removeEventListener("mouseup", stopDrag);
            document.removeEventListener("touchmove", onDrag);
            document.removeEventListener("touchend", stopDrag);

            const stick = document.getElementById("stick");
            stick.style.left = '6vmin';
            stick.style.top = '6vmin';
        }
    </script>
    <h1 id="main-title1">ğŸŒŸğŸæœ¬æ¸¸æˆç”±è¾›å…‰æœ¬äººç‰ˆæƒæ‰€æœ‰ï½œæ„Ÿè°¢æ‚¨å¤šå¹´çš„æ”¯æŒä¸å¸®åŠ©ğŸğŸŒŸ</h1>
</body>
</html>
